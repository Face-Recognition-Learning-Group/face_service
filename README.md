# VSOURCE-FACE-PLATFORM

VSOURCE团队开源一个精美的支持弹性编排的人脸算法平台，支持人脸对比的服务，网站平台功能齐备，而且整体的架构支持弹性的编排。

预览：[点击这里进入预览网站](http://120.26.143.61/)

注1：为了服务器安全，暂不提供账号，可以以游客身份进行登陆，即在登陆页面选择login as a visitor，游客身份只可以看，不可以提交人脸图像进行验证的任务；

注2：该项目可以用来部署作为自己的算法展示平台，也可以用于学习微服务架构模式，也可以用于毕业设计（不是）等任务；

注3：以一杯咖啡的价格，可以获得项目团队手把手的帮助部署该项目，详情见最下方。

### 一、预览

![face_preview](http://ecohnoch.cn/img/face_preview.png)

具有以下功能：

1. 用户登陆与权限控制。
2. 人脸对比的服务，可以验证两张人脸是一个人的相似分数。
3. 任务调用记录会进行用户视图隔离。

### 二、弹性编排的架构

架构图如下所示：

![face_structure](http://ecohnoch.cn/img/face_structure.png)

正常的一个人脸验证的流程是：（1）用户向网页上传两张人脸图像，（2）用户向网页提交了一个表单请求，（3）服务器处理这个请求，并且调用人脸识别算法来计算两者相似分数，包装成一个响应返回，并记录数据库，（4）用户查看响应结果。

而我们知道，算法的服务往往都需要一些计算时间，而且会非常的占用服务器的资源，一旦请求变多，服务器很容易因此无法承受，而且请求变多的时候，需要更多的机器来帮助计算，这个时候又需要修改代码来适配分布式处理。

我们提供的流程是：（1）用户向网页上传两张人脸图像，图像会被Web容器上传到存储节点，（2）用户向网页提交了一个表单请求，（3）Web容器将请求包装一下发给消息队列，返回用户响应，（4）这个时候用户回到服务调用页，刷新后下面会从带缓存的数据库中拉取计算的结果，（5）在第三步和第四步之间，消息队列拿到请求后，分发给请求写入节点和计算节点，请求写入节点将请求记录进数据库，并且计算节点调用算法服务进行计算，将结果推入redis缓存，会有结果收集节点从redis缓存推出结果，并记录进数据库。


### 三、部署该项目

部署该项目需要预先满足以下条件：

1. 有一台装有docker和docker-compose的机器。
2. 有人脸验证算法服务的参数，当然没有的话页面可以正常的启动，只是人脸的服务无法使用，关于参数的获取见下方。

满足条件后，下载本项目，在项目目录下cd进入face_service_deploy，并且docker-compose up即可启动服务。

启动服务需要一段的时间（大概1分钟左右），在日志稳定后，即可调用http://localhost:12349查看页面，默认的用户名和密码分别是xxxxxx@qq.com和xxxxxx123。

### 四、相关支持

该项目用到了以下的框架和依赖：

1. 前端：Layui、Tailwindcss
2. 后端：Flask、Flask-login
3. 消息队列：Kafka
4. 缓存：Redis
5. 数据库：MongoDB

项目中人脸识别的算法参数比较大，而且这个是项目成员自己训练的参数，网络图和配置来自于：[Tiny-Face-Recognition](https://github.com/Ecohnoch/Tiny-Face-Recognition)，有参数后将参数ckpt文件放到项目目录的face_calculator/face_recognition_native_api/ckpt下，如果需要直接拿到我们训练好的参数，参考下面的联系方式，并且请我们再喝一杯咖啡就可以了。

在部署中，如果出现任何的相关问题，可以联系项目成员（qq: 542305306，wechat: x542305306），以一杯咖啡的价格（40元），可以得到成员手把手的帮助和随时的答疑，想加入我们的话也可以直接提交pull request或者联系成员说明即可。
